<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WebSocket AES Chat</title>
  <style>
    body { font-family: Arial; margin: 2em; }
    #chat { border: 1px solid #ccc; padding: 1em; height: 200px; overflow-y: auto; margin-bottom: 1em; }
    #input { width: 80%; }
    #send { width: 15%; }
  </style>
</head>
<body>
  <h2>WebSocket AES Chat</h2>
  <div id="chat"></div>
  <input id="input" type="text" placeholder="Type your message...">
  <button id="send">Send</button>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
  <script>
    const SECRET_KEY = 'my_secret_key_123';
    const ws = new WebSocket(`ws://${location.host}`);
    const chat = document.getElementById('chat');
    const input = document.getElementById('input');
    const sendBtn = document.getElementById('send');

    function append(msg, isMine) {
      const div = document.createElement('div');
      div.textContent = msg;
      div.style.textAlign = isMine ? 'right' : 'left';
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    sendBtn.onclick = () => {
      const text = input.value;
      if (!text) return;
      // Encrypt message
      const encrypted = CryptoJS.AES.encrypt(text, SECRET_KEY).toString();
      ws.send(encrypted);
      append('Me: ' + text, true);
      input.value = '';
    };

    ws.onmessage = (event) => {
      // Decrypt message
      const bytes = CryptoJS.AES.decrypt(event.data, SECRET_KEY);
      const decrypted = bytes.toString(CryptoJS.enc.Utf8);
      append('Server: ' + decrypted, false);
    };
  </script>
</body>
</html>
